# PyMuPDFä»£æ›¿ãƒ©ã‚¤ãƒ–ãƒ©ãƒªèª¿æŸ»ãƒ¬ãƒãƒ¼ãƒˆ

**ä½œæˆæ—¥**: 2025-12-12
**é–¢é€£Issue**: #40
**ç›®çš„**: AGPLãƒ©ã‚¤ã‚»ãƒ³ã‚¹åˆ¶ç´„ã‚’å›é¿ã™ã‚‹ãŸã‚ã€PyMuPDFã®ä»£æ›¿æ‰‹æ®µã‚’èª¿æŸ»

---

## ç›®æ¬¡

1. [èƒŒæ™¯ã¨å‹•æ©Ÿ](#1-èƒŒæ™¯ã¨å‹•æ©Ÿ)
2. [ç¾åœ¨ã®ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£](#2-ç¾åœ¨ã®ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£)
3. [ä»£æ›¿ãƒ©ã‚¤ãƒ–ãƒ©ãƒªèª¿æŸ»](#3-ä»£æ›¿ãƒ©ã‚¤ãƒ–ãƒ©ãƒªèª¿æŸ»)
4. [ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£é¸æŠè‚¢](#4-ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£é¸æŠè‚¢)
5. [æŠ€è¡“çš„èª²é¡Œ](#5-æŠ€è¡“çš„èª²é¡Œ)
6. [æ¨å¥¨ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ](#6-æ¨å¥¨ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ)
7. [æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—](#7-æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—)
8. [å‚è€ƒæ–‡çŒ®](#8-å‚è€ƒæ–‡çŒ®)

---

## 1. èƒŒæ™¯ã¨å‹•æ©Ÿ

### 1.1 ç¾çŠ¶ã®å•é¡Œ

æœ¬ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯ç¾åœ¨ **AGPL-3.0** ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã§å…¬é–‹ã•ã‚Œã¦ã„ã‚‹ãŒã€ã“ã‚Œã¯ä¸»ã« **PyMuPDF (fitz)** ã®ä¾å­˜é–¢ä¿‚ã«èµ·å› ã™ã‚‹ã€‚

| ãƒ©ã‚¤ãƒ–ãƒ©ãƒª | ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ | å½±éŸ¿ |
|-----------|-----------|------|
| PyMuPDF | **AGPL-3.0** | ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå…¨ä½“ã‚’AGPLã«å¼·åˆ¶ |
| PP-DocLayout | Apache 2.0 | åˆ¶é™ãªã— |
| PaddleOCR | Apache 2.0 | åˆ¶é™ãªã— |

### 1.2 ç›®æ¨™

PyMuPDFã‚’æ’é™¤ã—ã€**Apache 2.0** ã¾ãŸã¯åŒç­‰ã®å¯›å®¹ãªãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ã¿ã§æ§‹æˆã™ã‚‹ã“ã¨ã§ã€ä»¥ä¸‹ã‚’å®Ÿç¾ï¼š

- **å•†ç”¨ãƒ©ã‚¤ã‚»ãƒ³ã‚¹è²©å£²ã®å®¹æ˜“åŒ–**
- **ã‚¯ãƒ­ãƒ¼ã‚ºãƒ‰ã‚½ãƒ¼ã‚¹æ´¾ç”Ÿç‰©ã®è¨±å¯**
- **ãƒ©ã‚¤ã‚»ãƒ³ã‚¹æ¡ä»¶ã®ç°¡ç´ åŒ–**

---

## 2. ç¾åœ¨ã®ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

### 2.1 PDFç¿»è¨³ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼

```
[å…¥åŠ›PDF]
    â”‚
    â”œâ”€â‘  ãƒ†ã‚­ã‚¹ãƒˆæŠ½å‡ºï¼ˆbboxåº§æ¨™ä»˜ãï¼‰â”€â”€â†’ PyMuPDF
    â”‚
    â”œâ”€â‘¡ ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆåˆ†é¡ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ (æ–°è¦: PP-DocLayout)
    â”‚
    â”œâ”€â‘¢ ãƒ†ã‚­ã‚¹ãƒˆå‰Šé™¤ï¼ˆå¢¨æ¶ˆã—ï¼‰â”€â”€â”€â”€â”€â”€â”€â”€â†’ PyMuPDF âš ï¸ ä»£æ›¿å›°é›£
    â”‚
    â”œâ”€â‘£ ç¿»è¨³å‡¦ç† â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ Google/DeepL/OpenAI
    â”‚
    â”œâ”€â‘¤ ãƒ†ã‚­ã‚¹ãƒˆæŒ¿å…¥ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ PyMuPDF
    â”‚
    â””â”€â‘¥ å‡ºåŠ›PDFç”Ÿæˆ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ PyMuPDF

[å‡ºåŠ›PDFï¼ˆåŸæ–‡ï¼‹ç¿»è¨³ã®ä¸¦åˆ—è¡¨ç¤ºï¼‰]
```

### 2.2 PyMuPDFã®ä½¿ç”¨ç®‡æ‰€

| æ©Ÿèƒ½ | ä½¿ç”¨ãƒ¡ã‚½ãƒƒãƒ‰ | ä»£æ›¿é›£æ˜“åº¦ |
|------|------------|-----------|
| ãƒ†ã‚­ã‚¹ãƒˆæŠ½å‡º | `get_text("dict")` | â­ å®¹æ˜“ |
| ãƒšãƒ¼ã‚¸ç”»åƒåŒ– | `get_pixmap()` | â­ å®¹æ˜“ |
| ãƒ†ã‚­ã‚¹ãƒˆå‰Šé™¤ | `add_redact_annot()` + `apply_redactions()` | â­â­â­ å›°é›£ |
| ãƒ†ã‚­ã‚¹ãƒˆæŒ¿å…¥ | `insert_textbox()` | â­â­ ä¸­ç¨‹åº¦ |
| PDFçµåˆ/åˆ†å‰² | `insert_pdf()` | â­â­ ä¸­ç¨‹åº¦ |

---

## 3. ä»£æ›¿ãƒ©ã‚¤ãƒ–ãƒ©ãƒªèª¿æŸ»

### 3.1 ãƒ†ã‚­ã‚¹ãƒˆæŠ½å‡ºï¼ˆbboxä»˜ãï¼‰

| ãƒ©ã‚¤ãƒ–ãƒ©ãƒª | ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ | bboxå–å¾— | ç²¾åº¦ | å‚™è€ƒ |
|-----------|-----------|:--------:|:----:|------|
| **pdftext** | **Apache 2.0** | âœ… | é«˜ | pypdfium2ãƒ™ãƒ¼ã‚¹ã€PyMuPDFåŒç­‰ |
| pypdfium2 | Apache 2.0 | âœ… | é«˜ | Google PDFiumãƒã‚¤ãƒ³ãƒ‡ã‚£ãƒ³ã‚° |
| pypdf | BSD-3-Clause | âš ï¸ | ä¸­ | æ–‡å­—å˜ä½bboxéå¯¾å¿œ |
| pdfplumber | MIT | âœ… | é«˜ | pdfminerãƒ™ãƒ¼ã‚¹ |

**æ¨å¥¨**: **pdftext** (Apache 2.0)

```python
from pdftext.extraction import plain_text_output, dictionary_output

# bboxä»˜ããƒ†ã‚­ã‚¹ãƒˆæŠ½å‡º
result = dictionary_output(pdf_path, sort=True, keep_chars=True)
# result["pages"][0]["blocks"][0]["bbox"] â†’ [x1, y1, x2, y2]
```

### 3.2 PDFâ†’ç”»åƒãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°

| ãƒ©ã‚¤ãƒ–ãƒ©ãƒª | ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ | å“è³ª | é€Ÿåº¦ | å‚™è€ƒ |
|-----------|-----------|:----:|:----:|------|
| **pypdfium2** | **Apache 2.0** | é«˜ | é«˜é€Ÿ | Google PDFium |
| pdf2image | MIT | é«˜ | ä¸­ | Popplerä¾å­˜ |
| Wand | MIT | é«˜ | é…ã„ | ImageMagickä¾å­˜ |

**æ¨å¥¨**: **pypdfium2** (Apache 2.0)

```python
import pypdfium2 as pdfium

pdf = pdfium.PdfDocument(pdf_path)
for page in pdf:
    image = page.render(scale=2).to_pil()
    # PP-DocLayoutã«æ¸¡ã™
```

### 3.3 ãƒ†ã‚­ã‚¹ãƒˆå‰Šé™¤ï¼ˆå¢¨æ¶ˆã—ï¼‰âš ï¸ æœ€é›£é–¢

| ãƒ©ã‚¤ãƒ–ãƒ©ãƒª | ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ | å¢¨æ¶ˆã—å¯¾å¿œ | å“è³ª | å‚™è€ƒ |
|-----------|-----------|:--------:|:----:|------|
| **PyMuPDF** | AGPL-3.0 | âœ… å®Œå…¨ | é«˜ | æ¥­ç•Œæ¨™æº– |
| pdf-redactor | CC0 (PD) | âš ï¸ regex | ä¸­ | pdfrwãƒ™ãƒ¼ã‚¹ |
| pikepdf | MPL-2.0 | âš ï¸ è¤‡é›‘ | ä¸­ | ä½ãƒ¬ãƒ™ãƒ«API |
| pypdfium2 | Apache 2.0 | âŒ | - | æœªå®Ÿè£… |

**é‡è¦ãªç™ºè¦‹**:
Apache 2.0ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã§**ç¢ºå®Ÿãªãƒ†ã‚­ã‚¹ãƒˆå¢¨æ¶ˆã—**ã‚’è¡Œãˆã‚‹ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¯**å­˜åœ¨ã—ãªã„**ã€‚

#### pdf-redactor (CC0)

```python
import pdf_redactor

options = pdf_redactor.RedactorOptions()
options.content_filters = [
    (re.compile(r"ç¿»è¨³å¯¾è±¡ãƒ†ã‚­ã‚¹ãƒˆ"), lambda m: "")
]
pdf_redactor.redact(input_path, output_path, options)
```

**åˆ¶é™**: æ­£è¦è¡¨ç¾ãƒãƒƒãƒãƒ³ã‚°ãƒ™ãƒ¼ã‚¹ã®ãŸã‚ã€bboxæŒ‡å®šã§ã®å‰Šé™¤ä¸å¯ã€‚

### 3.4 ãƒ†ã‚­ã‚¹ãƒˆæŒ¿å…¥

| ãƒ©ã‚¤ãƒ–ãƒ©ãƒª | ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ | ãƒ†ã‚­ã‚¹ãƒˆæŒ¿å…¥ | ãƒ•ã‚©ãƒ³ãƒˆå¯¾å¿œ | å‚™è€ƒ |
|-----------|-----------|:----------:|:----------:|------|
| **pypdfium2** | **Apache 2.0** | âœ… | âœ… | `insert_text()` |
| reportlab | BSD | âœ… | âœ… | PDFç”Ÿæˆå°‚ç”¨ |
| pikepdf | MPL-2.0 | âš ï¸ | âš ï¸ | ä½ãƒ¬ãƒ™ãƒ« |

**æ¨å¥¨**: **pypdfium2** (Apache 2.0)

```python
import pypdfium2 as pdfium

pdf = pdfium.PdfDocument(pdf_path)
page = pdf[0]
page.insert_text(
    text="ç¿»è¨³ãƒ†ã‚­ã‚¹ãƒˆ",
    pos_x=100, pos_y=200,
    font_size=12,
    font_path="/path/to/font.ttf"
)
pdf.save(output_path)
```

---

## 4. ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£é¸æŠè‚¢

### 4.1 é¸æŠè‚¢A: PyMuPDFç¶™ç¶šï¼ˆç¾çŠ¶ç¶­æŒï¼‰

```
[PDF] â†’ [PyMuPDF] â†’ ãƒ†ã‚­ã‚¹ãƒˆæŠ½å‡º/å‰Šé™¤/æŒ¿å…¥
          â†“
      [PP-DocLayout] â†’ ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆåˆ†é¡
          â†“
      [å‡ºåŠ›PDF]
```

| è©•ä¾¡é …ç›® | è©•ä¾¡ |
|---------|------|
| å®Ÿè£…ã‚³ã‚¹ãƒˆ | â­ ä½ï¼ˆæ—¢å­˜ï¼‰ |
| å“è³ª | â­â­â­ é«˜ |
| ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ | âŒ AGPL-3.0å¼·åˆ¶ |

### 4.2 é¸æŠè‚¢B: ç”»åƒã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤æ–¹å¼

```
[PDF] â†’ [pypdfium2] â†’ ç”»åƒãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
          â†“
      [PP-DocLayout] â†’ ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆæ¤œå‡º
          â†“
      [pdftext] â†’ ãƒ†ã‚­ã‚¹ãƒˆæŠ½å‡º
          â†“
      [ç”»åƒå‡¦ç†] â†’ ãƒ†ã‚­ã‚¹ãƒˆé ˜åŸŸã‚’ç™½å¡—ã‚Š
          â†“
      [pypdfium2/reportlab] â†’ ç¿»è¨³ãƒ†ã‚­ã‚¹ãƒˆæç”»
          â†“
      [æ–°è¦PDFç”Ÿæˆ]
```

| è©•ä¾¡é …ç›® | è©•ä¾¡ |
|---------|------|
| å®Ÿè£…ã‚³ã‚¹ãƒˆ | â­â­â­ é«˜ |
| å“è³ª | â­â­ ä¸­ï¼ˆãƒ©ã‚¹ã‚¿ãƒ©ã‚¤ã‚ºï¼‰ |
| ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ | âœ… Apache 2.0å¯èƒ½ |

**èª²é¡Œ**:
- å…ƒPDFãŒãƒ©ã‚¹ã‚¿ãƒ©ã‚¤ã‚ºã•ã‚Œã€ãƒ†ã‚­ã‚¹ãƒˆæ¤œç´¢ãƒ»ã‚³ãƒ”ãƒ¼ä¸å¯
- ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºå¢—å¤§
- ãƒ•ã‚©ãƒ³ãƒˆå“è³ªä½ä¸‹

### 4.3 é¸æŠè‚¢C: ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰PDFå†æ§‹ç¯‰

```
[PDF] â†’ [pdftext] â†’ ãƒ†ã‚­ã‚¹ãƒˆæŠ½å‡ºï¼ˆåº§æ¨™ä»˜ãï¼‰
          â†“
      [pypdfium2] â†’ ç”»åƒæŠ½å‡º/ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
          â†“
      [PP-DocLayout] â†’ ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆåˆ†é¡
          â†“
      [ç¿»è¨³å‡¦ç†]
          â†“
      [reportlab] â†’ æ–°è¦PDFæ§‹ç¯‰
          â”œâ”€â”€ ç¿»è¨³ãƒ†ã‚­ã‚¹ãƒˆï¼ˆãƒ†ã‚­ã‚¹ãƒˆãƒ¬ã‚¤ãƒ¤ãƒ¼ï¼‰
          â””â”€â”€ å…ƒç”»åƒ/å›³è¡¨ï¼ˆç”»åƒãƒ¬ã‚¤ãƒ¤ãƒ¼ï¼‰
```

| è©•ä¾¡é …ç›® | è©•ä¾¡ |
|---------|------|
| å®Ÿè£…ã‚³ã‚¹ãƒˆ | â­â­â­ é«˜ |
| å“è³ª | â­â­ ä¸­ã€œé«˜ |
| ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ | âœ… Apache 2.0å¯èƒ½ |

**èª²é¡Œ**:
- è¤‡é›‘ãªå®Ÿè£…
- å…ƒPDFã®ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆå®Œå…¨å†ç¾ãŒå›°é›£
- æ•°å¼ãƒ»è¡¨ã®å‡¦ç†ãŒè¤‡é›‘

### 4.4 é¸æŠè‚¢D: OCRãƒ™ãƒ¼ã‚¹å®Œå…¨å†æ§‹ç¯‰

```
[PDF] â†’ [pypdfium2] â†’ å…¨ãƒšãƒ¼ã‚¸ç”»åƒåŒ–
          â†“
      [PPStructureV3] â†’ ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆæ¤œå‡º + OCR
          â†“
      [ç¿»è¨³å‡¦ç†]
          â†“
      [reportlab] â†’ æ–°è¦PDFç”Ÿæˆ
```

| è©•ä¾¡é …ç›® | è©•ä¾¡ |
|---------|------|
| å®Ÿè£…ã‚³ã‚¹ãƒˆ | â­â­ ä¸­ |
| å“è³ª | â­ ä½ï¼ˆOCRç²¾åº¦ä¾å­˜ï¼‰ |
| ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ | âœ… Apache 2.0å¯èƒ½ |

**èª²é¡Œ**:
- åŸ‹ã‚è¾¼ã¿ãƒ†ã‚­ã‚¹ãƒˆãŒã‚ã‚‹PDFã§ã‚‚OCRãŒå¿…è¦
- OCRèª¤èªè­˜ãƒªã‚¹ã‚¯
- å…ƒPDFã®å“è³ªã‚’å®Œå…¨ã«å¤±ã†

---

## 5. æŠ€è¡“çš„èª²é¡Œ

### 5.1 ãƒ†ã‚­ã‚¹ãƒˆå‰Šé™¤ã®é›£ã—ã•

PDFã®ãƒ†ã‚­ã‚¹ãƒˆå‰Šé™¤ï¼ˆå¢¨æ¶ˆã—ï¼‰ãŒå›°é›£ãªç†ç”±ï¼š

1. **PDFæ§‹é€ ã®è¤‡é›‘ã•**: PDFã¯ãƒšãƒ¼ã‚¸è¨˜è¿°è¨€èªã§ã‚ã‚Šã€ãƒ†ã‚­ã‚¹ãƒˆã¯æç”»å‘½ä»¤ã¨ã—ã¦åŸ‹ã‚è¾¼ã¾ã‚Œã¦ã„ã‚‹
2. **åº§æ¨™ç³»ã®å¤‰æ›**: ãƒ†ã‚­ã‚¹ãƒˆã®åº§æ¨™ç³»ã¯è¤‡æ•°ã®å¤‰æ›è¡Œåˆ—ã‚’çµŒç”±
3. **ãƒ•ã‚©ãƒ³ãƒˆåŸ‹ã‚è¾¼ã¿**: å‰Šé™¤å¾Œã®ãƒ•ã‚©ãƒ³ãƒˆã‚µãƒ–ã‚»ãƒƒãƒˆå†è¨ˆç®—ãŒå¿…è¦
4. **é€æ˜åº¦ãƒ»é‡ã­åˆã‚ã›**: ä»–ã®è¦ç´ ã¨ã®é‡ãªã‚Šã‚’è€ƒæ…®

### 5.2 å„ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®å¢¨æ¶ˆã—å®Ÿè£…çŠ¶æ³

| ãƒ©ã‚¤ãƒ–ãƒ©ãƒª | å®Ÿè£…æ–¹å¼ | åˆ¶é™ |
|-----------|---------|------|
| PyMuPDF | MuPDF C APIãƒ©ãƒƒãƒ— | å®Œå…¨ãªå¢¨æ¶ˆã— |
| pdf-redactor | pdfrwã§ã‚¹ãƒˆãƒªãƒ¼ãƒ æ›¸ãæ›ãˆ | æ­£è¦è¡¨ç¾ãƒãƒƒãƒã®ã¿ |
| pikepdf | QPDFã§ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¹ãƒˆãƒªãƒ¼ãƒ æ“ä½œ | ä½ãƒ¬ãƒ™ãƒ«APIã€è¤‡é›‘ |

### 5.3 pypdfium2ã®å¢¨æ¶ˆã—å¯èƒ½æ€§ âœ… **æ¤œè¨¼å®Œäº†**

**2025-12-12æ¤œè¨¼çµæœ: å®Ÿç”¨çš„ã§ã‚ã‚‹ã“ã¨ã‚’ç¢ºèª**

pypdfium2ã®PDFium APIã‚’ä½¿ç”¨ã—ãŸãƒ†ã‚­ã‚¹ãƒˆå‰Šé™¤ãƒ»æŒ¿å…¥ãŒå®Œå…¨ã«å‹•ä½œã™ã‚‹ã“ã¨ã‚’ç¢ºèªã—ãŸã€‚

#### æ¤œè¨¼æ¸ˆã¿æ©Ÿèƒ½

| æ©Ÿèƒ½ | çµæœ | å‚™è€ƒ |
|------|:----:|------|
| ãƒ†ã‚­ã‚¹ãƒˆã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆåˆ—æŒ™ | âœ… | `page.get_objects(filter=[FPDF_PAGEOBJ_TEXT])` |
| ãƒã‚¦ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ãƒœãƒƒã‚¯ã‚¹å–å¾— | âœ… | `obj.get_bounds()` â†’ `(left, bottom, right, top)` |
| ãƒ†ã‚­ã‚¹ãƒˆã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆå‰Šé™¤ | âœ… | `page.remove_obj(obj)` |
| ã‚³ãƒ³ãƒ†ãƒ³ãƒ„å†ç”Ÿæˆ | âœ… | `page.gen_content()` |
| æ¨™æº–ãƒ•ã‚©ãƒ³ãƒˆãƒ†ã‚­ã‚¹ãƒˆæŒ¿å…¥ | âœ… | Helveticaç­‰ |
| TrueTypeãƒ•ã‚©ãƒ³ãƒˆãƒ†ã‚­ã‚¹ãƒˆæŒ¿å…¥ | âœ… | ã‚«ã‚¹ã‚¿ãƒ ãƒ•ã‚©ãƒ³ãƒˆ |
| æ—¥æœ¬èªCIDãƒ•ã‚©ãƒ³ãƒˆãƒ†ã‚­ã‚¹ãƒˆæŒ¿å…¥ | âœ… | IPAæ˜æœç­‰ |
| å®Œå…¨ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ | âœ… | å‰Šé™¤ â†’ æŒ¿å…¥ â†’ ä¿å­˜ |

#### å®Ÿè£…ä¾‹ï¼ˆæ¤œè¨¼æ¸ˆã¿ï¼‰

**ãƒ†ã‚­ã‚¹ãƒˆå‰Šé™¤:**
```python
import pypdfium2 as pdfium

FPDF_PAGEOBJ_TEXT = pdfium.raw.FPDF_PAGEOBJ_TEXT

pdf = pdfium.PdfDocument(pdf_path)
page = pdf[0]

# ãƒ†ã‚­ã‚¹ãƒˆã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’åˆ—æŒ™
for obj in page.get_objects(filter=[FPDF_PAGEOBJ_TEXT]):
    bounds = obj.get_bounds()  # (left, bottom, right, top)

    # ç‰¹å®šã®é ˜åŸŸå†…ã®ãƒ†ã‚­ã‚¹ãƒˆã‚’å‰Šé™¤
    if bounds[1] >= 750:  # yåº§æ¨™ãŒ750ä»¥ä¸Š
        page.remove_obj(obj)

page.gen_content()

with open(output_path, "wb") as f:
    pdf.save(f)
```

**ãƒ†ã‚­ã‚¹ãƒˆæŒ¿å…¥ï¼ˆraw APIä½¿ç”¨ï¼‰:**
```python
import pypdfium2 as pdfium
import ctypes

def to_widestring(text: str):
    """UTF-16LEã«å¤‰æ›"""
    encoded = text.encode('utf-16-le') + b'\x00\x00'
    arr = (ctypes.c_ushort * (len(encoded) // 2))()
    for i in range(len(encoded) // 2):
        arr[i] = int.from_bytes(encoded[i*2:i*2+2], 'little')
    return arr

def to_byte_array(data: bytes):
    """ãƒã‚¤ãƒˆé…åˆ—ã«å¤‰æ›"""
    arr = (ctypes.c_ubyte * len(data))()
    for i, b in enumerate(data):
        arr[i] = b
    return arr

# ãƒ•ã‚©ãƒ³ãƒˆã‚’èª­ã¿è¾¼ã¿
with open(font_path, "rb") as f:
    font_data = f.read()

font_arr = to_byte_array(font_data)
font_handle = pdfium.raw.FPDFText_LoadFont(
    pdf.raw,
    font_arr,
    ctypes.c_uint(len(font_data)),
    ctypes.c_int(pdfium.raw.FPDF_FONT_TRUETYPE),
    ctypes.c_int(1)  # CID font for CJK
)

# ãƒ†ã‚­ã‚¹ãƒˆã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆä½œæˆ
text_obj = pdfium.raw.FPDFPageObj_CreateTextObj(
    pdf.raw, font_handle, ctypes.c_float(14.0)
)

# ãƒ†ã‚­ã‚¹ãƒˆè¨­å®š
text_ws = to_widestring("ç¿»è¨³ã•ã‚ŒãŸãƒ†ã‚­ã‚¹ãƒˆ")
pdfium.raw.FPDFText_SetText(text_obj, text_ws)

# ä½ç½®è¨­å®š
pdfium.raw.FPDFPageObj_Transform(
    text_obj,
    ctypes.c_double(1.0), ctypes.c_double(0.0),
    ctypes.c_double(0.0), ctypes.c_double(1.0),
    ctypes.c_double(x), ctypes.c_double(y)
)

# ãƒšãƒ¼ã‚¸ã«æŒ¿å…¥
pdfium.raw.FPDFPage_InsertObject(page.raw, text_obj)
page.gen_content()
```

#### æ¤œè¨¼ãƒ­ã‚°

```
tests/evaluation/outputs/pypdfium2_verification/
â”œâ”€â”€ verification_results.json      # åŸºæœ¬æ©Ÿèƒ½æ¤œè¨¼
â”œâ”€â”€ targeted_removal_results.json  # bboxæŒ‡å®šå‰Šé™¤æ¤œè¨¼
â”œâ”€â”€ text_insertion_v2_results.json # ãƒ†ã‚­ã‚¹ãƒˆæŒ¿å…¥æ¤œè¨¼
â”œâ”€â”€ modified_output.pdf            # å‰Šé™¤å¾ŒPDF
â”œâ”€â”€ targeted_removal_output.pdf    # bboxæŒ‡å®šå‰Šé™¤å¾ŒPDF
â”œâ”€â”€ standard_font_v2.pdf           # æ¨™æº–ãƒ•ã‚©ãƒ³ãƒˆãƒ†ã‚¹ãƒˆ
â”œâ”€â”€ truetype_font_v2.pdf           # TrueTypeãƒ•ã‚©ãƒ³ãƒˆãƒ†ã‚¹ãƒˆ
â”œâ”€â”€ japanese_cid_v2.pdf            # æ—¥æœ¬èªãƒ•ã‚©ãƒ³ãƒˆãƒ†ã‚¹ãƒˆ
â””â”€â”€ full_workflow_v2.pdf           # å®Œå…¨ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ãƒ†ã‚¹ãƒˆ
```

**çµè«–**: pypdfium2ã¯PyMuPDFã®ä»£æ›¿ã¨ã—ã¦**å®Ÿç”¨çš„**ã§ã‚ã‚‹ã€‚

---

## 6. æ¨å¥¨ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ âœ… **æ›´æ–°: 2025-12-12**

### 6.1 æ¨å¥¨: pypdfium2ã«ã‚ˆã‚‹å®Œå…¨Apache 2.0åŒ– ğŸ‰

**æ¤œè¨¼çµæœã«åŸºã¥ãã€pypdfium2ã§PyMuPDFã‚’å®Œå…¨ã«ä»£æ›¿å¯èƒ½ã§ã‚ã‚‹ã“ã¨ãŒç¢ºèªã•ã‚ŒãŸã€‚**

```
[PDF] â†’ [pypdfium2] â†’ ãƒ†ã‚­ã‚¹ãƒˆæŠ½å‡ºï¼ˆApache 2.0ï¼‰âœ…
          â†“
      [pypdfium2] â†’ ç”»åƒãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ï¼ˆApache 2.0ï¼‰âœ…
          â†“
      [PP-DocLayout] â†’ ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆåˆ†é¡ï¼ˆApache 2.0ï¼‰âœ…
          â†“
      [pypdfium2] â†’ ãƒ†ã‚­ã‚¹ãƒˆå‰Šé™¤ï¼ˆApache 2.0ï¼‰âœ… NEW!
          â†“
      [pypdfium2] â†’ ãƒ†ã‚­ã‚¹ãƒˆæŒ¿å…¥ï¼ˆApache 2.0ï¼‰âœ… NEW!
          â†“
      [å‡ºåŠ›PDF]
```

| è©•ä¾¡é …ç›® | è©•ä¾¡ |
|---------|------|
| å®Ÿè£…ã‚³ã‚¹ãƒˆ | â­â­ ä¸­ï¼ˆraw APIä½¿ç”¨ï¼‰ |
| å“è³ª | â­â­â­ é«˜ |
| ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ | âœ… **Apache 2.0ã®ã¿** |

**ãƒ¡ãƒªãƒƒãƒˆ**:
- **AGPL-3.0åˆ¶ç´„ã‹ã‚‰ã®å®Œå…¨è§£æ”¾**
- å•†ç”¨ãƒ©ã‚¤ã‚»ãƒ³ã‚¹è²©å£²ãŒå®¹æ˜“ã«
- ã‚¯ãƒ­ãƒ¼ã‚ºãƒ‰ã‚½ãƒ¼ã‚¹æ´¾ç”Ÿç‰©ã®è¨±å¯
- Google PDFiumã®é«˜å“è³ªãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°

**æ³¨æ„ç‚¹**:
- ãƒ†ã‚­ã‚¹ãƒˆæŒ¿å…¥ã«raw APIï¼ˆctypesï¼‰ãŒå¿…è¦
- ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°ã®é–‹ç™ºãŒæ¨å¥¨

### 6.2 å®Ÿè£…ãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ—

#### Phase 1: pypdfium2ãƒ©ãƒƒãƒ‘ãƒ¼é–‹ç™º
```python
# æ–°è¦ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«: src/index_pdf_translation/core/pypdfium2_wrapper.py

class PdfiumTextEditor:
    """pypdfium2ã§ãƒ†ã‚­ã‚¹ãƒˆç·¨é›†ã‚’è¡Œã†ãƒ©ãƒƒãƒ‘ãƒ¼ã‚¯ãƒ©ã‚¹"""

    def remove_text_in_region(self, page, bbox):
        """æŒ‡å®šé ˜åŸŸå†…ã®ãƒ†ã‚­ã‚¹ãƒˆã‚’å‰Šé™¤"""

    def insert_text(self, page, text, pos, font_path, font_size):
        """ãƒ†ã‚­ã‚¹ãƒˆã‚’æŒ¿å…¥"""
```

#### Phase 2: æ—¢å­˜ã‚³ãƒ¼ãƒ‰ç§»è¡Œ
1. `pdf_edit.py`ã®PyMuPDFä¾å­˜éƒ¨åˆ†ã‚’pypdfium2ã«ç½®æ›
2. ãƒ†ã‚­ã‚¹ãƒˆæŠ½å‡º: `pdftext`ã¾ãŸã¯`pypdfium2`ã‚’ä½¿ç”¨
3. ãƒ†ã‚­ã‚¹ãƒˆå‰Šé™¤/æŒ¿å…¥: æ–°è¦ãƒ©ãƒƒãƒ‘ãƒ¼ã‚’ä½¿ç”¨

#### Phase 3: ãƒ†ã‚¹ãƒˆãƒ»æœ€é©åŒ–
1. æ—¢å­˜ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã§ã®å‹•ä½œç¢ºèª
2. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ¯”è¼ƒï¼ˆPyMuPDF vs pypdfium2ï¼‰
3. ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹å¯¾å¿œ

### 6.3 ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯: PyMuPDFç¶™ç¶š

ä¸‡ãŒä¸€pypdfium2ã§å•é¡ŒãŒç™ºç”Ÿã—ãŸå ´åˆã®ä»£æ›¿æ¡ˆ:

```
[PDF] â†’ [pypdfium2] â†’ ãƒ†ã‚­ã‚¹ãƒˆæŠ½å‡º/ç”»åƒåŒ–ï¼ˆApache 2.0ï¼‰
          â†“
      [PP-DocLayout] â†’ ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆåˆ†é¡ï¼ˆApache 2.0ï¼‰
          â†“
      [PyMuPDF] â†’ ãƒ†ã‚­ã‚¹ãƒˆå‰Šé™¤/æŒ¿å…¥ï¼ˆAGPL-3.0ï¼‰âš ï¸
          â†“
      [å‡ºåŠ›PDF]
```

**ã“ã®å ´åˆã®ãƒ©ã‚¤ã‚»ãƒ³ã‚¹**: AGPL-3.0

---

## 7. æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ— âœ… **æ›´æ–°: 2025-12-12**

### 7.1 å®Œäº†ã‚¿ã‚¹ã‚¯ âœ…

- [x] pypdfium2ã® `FPDFPage_RemoveObject()` æ¤œè¨¼ â†’ **æˆåŠŸ**
- [x] pypdfium2ã®ãƒ†ã‚­ã‚¹ãƒˆæŒ¿å…¥æ¤œè¨¼ï¼ˆraw APIï¼‰ â†’ **æˆåŠŸ**
- [x] æ—¥æœ¬èªCIDãƒ•ã‚©ãƒ³ãƒˆå¯¾å¿œæ¤œè¨¼ â†’ **æˆåŠŸ**
- [x] å®Œå…¨ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼æ¤œè¨¼ï¼ˆå‰Šé™¤â†’æŒ¿å…¥â†’ä¿å­˜ï¼‰ â†’ **æˆåŠŸ**

### 7.2 æ¬¡ã«å®Ÿæ–½ã™ã¹ãã‚¿ã‚¹ã‚¯

| ã‚¿ã‚¹ã‚¯ | å„ªå…ˆåº¦ | èª¬æ˜ |
|-------|:------:|------|
| pypdfium2ãƒ©ãƒƒãƒ‘ãƒ¼ã‚¯ãƒ©ã‚¹é–‹ç™º | ğŸ”´ é«˜ | `PdfiumTextEditor`ã‚¯ãƒ©ã‚¹ã®å®Ÿè£… |
| æ—¢å­˜pdf_edit.pyç§»è¡Œ | ğŸ”´ é«˜ | PyMuPDFâ†’pypdfium2ã¸ã®ç½®æ› |
| ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ | ğŸŸ¡ ä¸­ | å‡¦ç†é€Ÿåº¦ãƒ»ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡æ¯”è¼ƒ |
| ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹ãƒ†ã‚¹ãƒˆ | ğŸŸ¡ ä¸­ | è¤‡é›‘ãªPDFã€æ•°å¼ã€è¡¨å¯¾å¿œ |
| ãƒ©ã‚¤ã‚»ãƒ³ã‚¹å¤‰æ›´ | ğŸŸ¢ ä½ | AGPL-3.0â†’Apache 2.0ã¸ã®å¤‰æ›´ |

### 7.3 Issueä½œæˆææ¡ˆ

1. **pypdfium2ãƒ©ãƒƒãƒ‘ãƒ¼å®Ÿè£…** (å„ªå…ˆåº¦: é«˜)
   - `PdfiumTextEditor`ã‚¯ãƒ©ã‚¹ã®é–‹ç™º
   - ãƒ†ã‚­ã‚¹ãƒˆå‰Šé™¤ãƒ»æŒ¿å…¥ã®ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°

2. **PyMuPDFä¾å­˜æ’é™¤** (å„ªå…ˆåº¦: é«˜)
   - `pdf_edit.py`ã®pypdfium2ç§»è¡Œ
   - ä¾å­˜é–¢ä¿‚ã‹ã‚‰PyMuPDFã‚’å‰Šé™¤

3. **ãƒ©ã‚¤ã‚»ãƒ³ã‚¹å¤‰æ›´** (å„ªå…ˆåº¦: ä¸­)
   - AGPL-3.0ã‹ã‚‰Apache 2.0ã¸ã®ç§»è¡Œ
   - å„ãƒ•ã‚¡ã‚¤ãƒ«ã®SPDXè­˜åˆ¥å­æ›´æ–°

---

## 8. å‚è€ƒæ–‡çŒ®

### ãƒ©ã‚¤ãƒ–ãƒ©ãƒª

- [pdftext - PyPI](https://pypi.org/project/pdftext/) - Apache 2.0
- [pypdfium2 - GitHub](https://github.com/pypdfium2-team/pypdfium2) - Apache 2.0 / BSD-3-Clause
- [PaddleOCR - GitHub](https://github.com/PaddlePaddle/PaddleOCR) - Apache 2.0
- [PP-DocLayout - Hugging Face](https://huggingface.co/PaddlePaddle/PP-DocLayout-L) - Apache 2.0
- [pdf-redactor - GitHub](https://github.com/JoshData/pdf-redactor) - CC0
- [pikepdf - Documentation](https://pikepdf.readthedocs.io/) - MPL-2.0

### æŠ€è¡“è³‡æ–™

- [PDFium API Reference](https://pdfium.googlesource.com/pdfium/+/refs/heads/main/public/)
- [PDF Reference 1.7](https://www.adobe.com/content/dam/acom/en/devnet/pdf/pdfs/PDF32000_2008.pdf)

---

## ä»˜éŒ²: ãƒ©ã‚¤ã‚»ãƒ³ã‚¹æ¯”è¼ƒè¡¨

| ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ | å•†ç”¨åˆ©ç”¨ | æ´¾ç”Ÿç‰©å…¬é–‹ç¾©å‹™ | ä¿®æ­£éƒ¨åˆ†å…¬é–‹ | è©•ä¾¡ |
|-----------|:-------:|:------------:|:----------:|------|
| **Apache 2.0** | âœ… | âŒ | âŒ | æœ€ã‚‚å¯›å®¹ |
| **BSD-3-Clause** | âœ… | âŒ | âŒ | å¯›å®¹ |
| **MIT** | âœ… | âŒ | âŒ | å¯›å®¹ |
| **CC0** | âœ… | âŒ | âŒ | ãƒ‘ãƒ–ãƒªãƒƒã‚¯ãƒ‰ãƒ¡ã‚¤ãƒ³ |
| **MPL-2.0** | âœ… | âŒ | âœ… ãƒ•ã‚¡ã‚¤ãƒ«å˜ä½ | ä¸­ç¨‹åº¦ |
| **LGPL-3.0** | âœ… | âŒ | âœ… ãƒ©ã‚¤ãƒ–ãƒ©ãƒªéƒ¨åˆ† | ã‚„ã‚„åˆ¶é™çš„ |
| **AGPL-3.0** | âœ… | âœ… å…¨ä½“ | âœ… å…¨ä½“ | **åˆ¶é™çš„** |
